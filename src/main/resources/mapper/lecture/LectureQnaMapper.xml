<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seesun.mapper.qna.LectureQnaMapper">

    <resultMap id="LectureQnaMap" type="com.seesun.dto.lecture.LectureQnaDTO">
        <id property="qna_id" column="qna_id"/>
        <result property="le_id" column="le_id"/>
        <result property="mb_id" column="mb_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="answer" column="answer"/>
        <result property="ans_mb_id" column="ans_mb_id"/>
        <result property="authorNickname" column="authorNickname"/>
        <result property="mentor_id" column="mentor_id"/> <result property="created_at" column="created_at"/>
        <result property="modified_at" column="modified_at"/>
    </resultMap>

    <select id="getQnaListByLecture" resultMap="LectureQnaMap">
    SELECT 
        q.qna_id, q.le_id, q.mb_id, q.title, q.content, q.answer, 
        q.ans_mb_id, q.status, q.created_at, q.modified_at,
        m.nickname AS authorNickname,
        l.mb_id AS mentor_id
    FROM lecture_qna q
    JOIN lecture l ON q.le_id = l.le_id
    LEFT JOIN member m ON q.mb_id = m.mb_id
    WHERE q.le_id = #{leId}
    ORDER BY q.created_at DESC
</select>

    <insert id="insertQuestion" parameterType="com.seesun.dto.lecture.LectureQnaDTO">
        INSERT INTO lecture_qna (le_id, mb_id, title, content)
        VALUES (#{le_id}, #{mb_id}, #{title}, #{content})
    </insert>

    <update id="updateAnswer">
        UPDATE lecture_qna
        SET 
            answer = #{answer},
            ans_mb_id = #{ans_mb_id},
            status = 1,
            modified_at = NOW()
        WHERE qna_id = #{qna_id}
    </update>

</mapper>