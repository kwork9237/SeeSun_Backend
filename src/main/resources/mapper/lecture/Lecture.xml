<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seesun.mapper.lecture.LectureMapper">

    <resultMap id="LectureResultMap" type="com.seesun.dto.lecture.LectureDTO">
        <id property="leId" column="le_id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="cost" column="cost" />
        <result property="avgScore" column="avg_score" />
        <result property="difficulty" column="difficulty" />
        <result property="viewCount" column="view_count" />
        <result property="isActive" column="is_active" />
        <result property="mbId" column="mb_id" />
        <result property="instructorName" column="instructor_name" />
        <result property="profileIcon" column="profile_icon" />
        <result property="categoryName" column="category_name" />
        <result property="studentCount" column="student_count" />
        <result property="reviewCount" column="review_count" />
        <result property="totalHours" column="total_hours" />
        <result property="availableTime" column="available_time" />
        <result property="startDate" column="start_date" />
        <result property="endDate" column="end_date" />
        <result property="availableDays" column="available_days" />
    </resultMap>

    <select id="getLectureList" resultMap="LectureResultMap">
        </select>

    <select id="getLectureDetail" resultMap="LectureResultMap">
        </select>

    <insert id="insertLecture" useGeneratedKeys="true" keyProperty="dto.leId" keyColumn="le_id">
        INSERT INTO lecture (mb_id, title, content, lg_type_Id, cost, difficulty, is_active)
        VALUES (#{dto.mbId}, #{dto.title}, #{dto.description}, #{lgTypeId}, #{dto.price}, #{dto.level}, 1)
    </insert>
    
    <insert id="insertSection" useGeneratedKeys="true" keyProperty="section.sectionId" keyColumn="section_id">
        INSERT INTO lecture_section (le_id, title, order_num) 
        VALUES (#{leId}, #{section.title}, #{orderNum})
    </insert>
    
    <insert id="insertLesson">
        INSERT INTO lecture_lesson (section_id, title, duration, order_num) 
        VALUES (#{sectionId}, #{title}, #{duration}, #{orderNum})
    </insert>
    
    <insert id="insertSchedule">
        INSERT INTO lecture_schedule (le_id, schedule_date, start_time, end_time, max_students, current_students, is_available)
        VALUES (#{leId}, #{scheduleDate}, #{startTime}, #{endTime}, #{maxStudents}, 0, 1)
    </insert>

    <select id="getSectionsByLectureId" resultType="com.seesun.dto.lecture.SectionDTO">
        SELECT 
            section_id AS sectionId,
            title,
            order_num AS orderNum
        FROM lecture_section
        WHERE le_id = #{leId}
        ORDER BY order_num ASC
    </select>

    <select id="getLessonsBySectionId" resultType="com.seesun.dto.lecture.LessonDTO">
        SELECT 
            lesson_id AS lessonId,
            title,
            duration,
            order_num AS orderNum
        FROM lecture_lesson
        WHERE section_id = #{sectionId}
        ORDER BY order_num ASC
    </select>
</mapper>