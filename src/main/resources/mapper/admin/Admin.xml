<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.seesun.mapper.admin.AdminMapper">
	
	<!-- 관리자 메인 -->
	<select id="countNewMentorRequests" resultType="int">
        SELECT COUNT(*) 
        FROM request_mento where req_state = 0
    </select>
    <select id="countReportedLectures" resultType="int">
        SELECT COUNT(*) 
        FROM lecture
        WHERE is_active = 1
    </select>
    <select id="countUnansweredInquiries" resultType="int">
      <!--   SELECT COUNT(*) 
        FROM suggestion
        WHERE is_answered = 0 -->
    </select>
	
	<!-- 멘토 미승인 목록 -->
	<select id="selectPendingRequests" resultType="com.seesun.dto.admin.MentoRequestDTO">
        SELECT 
            req_id as reqId,
            mb_id as mbId,
            details,
            attachment,
            req_state as reqState
        FROM request_mento
      <!--   WHERE req_state = 0 -->
        ORDER BY req_id DESC
    </select>

	<!-- 멘토 승인 처리  -->
   <update id="updateRequestStatus" parameterType="int">
        UPDATE request_mento rm
        INNER JOIN member m ON rm.mb_id = m.mb_id
        SET rm.req_state = 1, 
            m.mb_type_id = 2
        WHERE rm.req_id = #{reqId}
    </update>
    
	
	<!-- 강의 신고 -->
	
	
	<!--건의 사항-->
	
	<!-- 공지사항 목록 -->
	   <select id="selectNotificationList" resultType="com.seesun.dto.notification.NotificationDTO">
		SELECT 
			nt_id AS ntId,
			mb_id AS mbId,
			title,
			content,
			view_count AS viewCount,
			created_at AS createdAt,
			modified_at AS modifiedAt
		FROM notification
		ORDER BY nt_id DESC
	</select>

	<!-- 공지 사항 작성 -->
	<insert id="insertNotification" parameterType="com.seesun.dto.notification.NotificationDTO">
        INSERT INTO notification (
            mb_id, 
            title, 
            content, 
            view_count, 
            created_at, 
            modified_at
        ) VALUES (
            #{mbId}, 
            #{title}, 
            #{content}, 
            0, 
            NOW(), 
            NOW()
        )
    </insert>
    
    <!-- 공지사항 상세 조회 -->
    <select id="selectNotificationDetail" resultType="com.seesun.dto.notification.NotificationDTO">
		SELECT 
			nt_id AS ntId,
			mb_id AS mbId,
			title,
			content,
			view_count AS viewCount,
			created_at AS createdAt,
			modified_at AS modifiedAt
		FROM notification
		WHERE nt_id = #{ntId}
	</select>
    
</mapper>	
	
