<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

<mapper namespace="com.seesun.mapper.admin.AdminMapper">
	
	<select id="countNewMentorRequests" resultType="int">
        SELECT COUNT(*) 
        FROM request_mento where req_state = 0
    </select>
    
    <select id="countReportedLectures" resultType="int">
        SELECT COUNT(*) 
        FROM lecture
        WHERE is_active = 1
    </select>
  	
    <select id="countUnansweredInquiries" resultType="int">
        SELECT COUNT(*) 
        FROM suggestion
        WHERE is_answered = 0
    </select>
	
	<select id="selectPendingRequests" resultType="com.seesun.dto.admin.MentoRequestListDTO">
        SELECT 
            req_id as reqId,
            mb_id as mbId,
            details,
            attachment,
            req_state as reqState
        FROM request_mento
        ORDER BY req_id DESC
    </select>

	<update id="updateRequestStatus" parameterType="int">
        UPDATE request_mento rm
        INNER JOIN member m ON rm.mb_id = m.mb_id
        SET rm.req_state = 1, 
            m.mb_type_id = 2
        WHERE rm.req_id = #{reqId}
    </update>
    
    <select id="selectSuggestionList" resultType="com.seesun.dto.suggestion.SuggestionDTO">
        SELECT 
            sg_id AS sgId,
            mb_id AS mbId,
            title,
            content,
            view_count AS viewCount,
            created_at AS createdAt,
            modified_at AS modifiedAt
        FROM suggestions
        ORDER BY sg_id DESC
    </select>
    
	<select id="selectSuggestionDetail" resultType="com.seesun.dto.suggestion.SuggestionDTO">
        SELECT 
            sg_id AS sgId,
            mb_id AS mbId,
            title,
            content,
            view_count AS viewCount,
            created_at AS createdAt,
            modified_at AS modifiedAt
        FROM suggestions
        WHERE sg_id = #{sgId}
    </select>

    <update id="increaseSuggestionViewCount" parameterType="long">
        UPDATE suggestions
        SET view_count = view_count + 1
        WHERE sg_id = #{sgId}
    </update>   
    
    
	<select id="selectNotificationList" resultType="com.seesun.dto.notification.NotificationDTO">
		SELECT 
			nt_id AS ntId,
			mb_id AS mbId,
			title,
			content,
			view_count AS viewCount,
			created_at AS createdAt,
			modified_at AS modifiedAt
		FROM notification
		ORDER BY nt_id DESC
	</select>
	

	<insert id="insertNotification" parameterType="com.seesun.dto.notification.NotificationDTO">
        INSERT INTO notification (
            mb_id, 
            title, 
            content, 
            view_count, 
            created_at, 
            modified_at
        ) VALUES (
            #{mbId}, 
            #{title}, 
            #{content}, 
            0, 
            NOW(), 
            NOW()
        )
    </insert>
    
    <select id="selectNotificationDetail" resultType="com.seesun.dto.notification.NotificationDTO">
		SELECT 
			nt_id AS ntId,
			mb_id AS mbId,
			title,
			content,
			view_count AS viewCount,
			created_at AS createdAt,
			modified_at AS modifiedAt
		FROM notification
		WHERE nt_id = #{ntId}
	</select>
	
	<update id="increaseViewCount" parameterType="Long">
		UPDATE notification
		SET view_count = view_count + 1
		WHERE nt_id = #{ntId}
	</update>
	
	<update id="updateNotification" parameterType="com.seesun.dto.notification.NotificationDTO">
        UPDATE notification
        SET 
            title = #{title},
            content = #{content},
            modified_at = NOW()
        WHERE nt_id = #{ntId}
    </update>
    
    <delete id="deleteNotification" parameterType="long">
        DELETE FROM notification 
        WHERE nt_id = #{ntId}
    </delete>
	
</mapper>